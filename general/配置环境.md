# cuda安装
## 下载cuda（10.1为例）
[cuda版本下载链接](https://developer.nvidia.com/cuda-toolkit-archive)

选择对应版本
![[Pasted image 20220704094247.png]]
![[Pasted image 20220704094720.png]]

## 下载对应cudnn(需要提前注册，找到对应版本，下载cuDNN Library for Linux压缩包即可)
[cudnn版本下载链接](https://developer.nvidia.com/rdp/cudnn-archive)

![[Pasted image 20220704100301.png]]

## 安装cuda
切换到cuda目录
> sudo bash cuda_10.1.105_4188.39_linux.run

安装过程中注意不要安装显卡驱动

![[Pasted image 20220704104736.png]]

安装完毕后在 ，打开".bashrc"
> vim ~/.bashrc

“.bashrc”最后一行添加环境变量,根据版本选择

> export CUDA_HOME=/usr/local/cuda-10.1
> 
> export LD_LIBRARY_PATH=${CUDA_HOME}/lib64
> 
> export PATH=${CUDA_HOME}/bin:${PATH}

或者  

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda-11.3/lib64:/home/tx-deepocean/miniconda3/envs/torch1.10/lib

保存退出
> source ~/.bashrc

验证
> nvcc -V

解压cudnn，复制相关文件到cuda安装目录

> sudo cp cuda/include/cudnn.h /usr/local/cuda/include/ 
> 
> sudo cp cuda/lib64/libcudnn* /usr/local/cuda/lib64/ 
>
> sudo chmod a+r /usr/local/cuda/include/cudnn.h 
> 
> sudo chmod a+r /usr/local/cuda/lib64/libcudnn*

测试cudnn
> cat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2
![[Pasted image 20220704111513.png]]


## **一、先卸载原cuda和nvidia驱动**  
- **卸载cuda**  
cd /usr/local/cuda/bin  
sudo ./cuda-uninstaller  
- **卸载nvidia驱动**  
sudo apt-get remove --purge nvidia*  
sudo apt-get --purge remove nvidia*  
sudo apt-get autoremove  
sudo apt-get --purge remove "*cublas*" "cuda*"  
sudo apt-get --purge remove "*nvidia*"  
sudo /usr/bin/nvidia-uninstall  
## 二、NVIDIA显卡驱动安装  
- **禁用nouveau和关闭图形界面**  
修改文件 /etc/modprobe.d/blacklist.conf ，最后添加如下两行  
blacklist nouveau  
options nouveau modeset=0  
更新系统修改  
sudo update-initramfs -u  
重启系统，验证nouveau是否已禁用，如果没有任何显示则禁用成功  
lsmod | grep nouveau  
关闭图形界面  
sudo service lightdm stop  
- **下载并安装**  
rsync -avP sxiongjie@192.168.125.53:/home/sxiongjie/桌面/media/Software/环境安装包 ./  
cd 环境安装包  
sudo chmod a+x NVIDIA-Linux-x86_64-470.94.run  
sudo ./NVIDIA-Linux-x86_64-470.94.run -no-x-check -no-nouveau-check -no-opengl-files  
*在安装过程中：  
1、he distribution-provided pre-install script failed! Are you sure you want to  
continue? 选择 yes 继续。  
2、Would you like to register the kernel module souces with DKMS? This will allow  
DKMS to automatically build a new module, if you install a different kernel later?  
选择NO继续  
3、Would you like to run the nvidia-xconfigutility to automatically update your x  
configuration so that the NVIDIA x driver will be used when you restart x? Any  
pre-existing x confile will be backed up. 选择 Yes 继续*  
安装完后开启图形界面：sudo service lightdm start  
验证是否安装成功：nvidia-smi  
## 三、CUDA安装  
先安装相关依赖  
sudo apt-get install freeglut3-dev build-essential libx11-dev libxmu-dev libxi-dev libgl1-mesa-glx libglu1-mesa libglu1-mesa-dev  
sudo sh cuda_11.5.1_495.29.05_linux.run  
运行过程中出现如下界面，务必去掉方框处的X，表示不安装。  
![a0a7b24f4ee9830a6198507e7a9e6b82.png](file:///home/sxiongjie/.config/joplin-desktop/resources/c037dfb64a174f76b9a97505ef9f942a.png)  
安装完成后开始环境变量的配置  
vim ~/.bashrc  
在文件的末尾加入下面三行保存退出：  
export LD_LIBRARY_PATH=$LD\_LIBRARY\_PATH:/usr/local/cuda/lib64 export PATH=$PATH:/usr/local/cuda/bin  
export CUDA_HOME=$CUDA_HOME:/usr/local/cuda  
更新环境变量：source ~/.bashrc  
验证是否安装成功：nvcc -V  
## 四、cudnn安装  
sudo cp cudnn-linux-x86_64-8.3.1.22_cuda11.5-archive/include/cudnn.h /usr/local/cuda/include  
sudo cp cudnn-linux-x86_64-8.3.1.22_cuda11.5-archive/lib/libcudnn* /usr/local/cuda/lib64/  
sudo chmod a+r /usr/local/cuda/include/cudnn.h  
sudo chmod a+r /usr/local/cuda/lib64/libcudnn*  
## 五、安装python环境  
conda create -n engine-env python=3.7.5  
conda activate engine-env  
pip install numpy==1.21.6  
pip install protobuf==3.20.1  
pip install Markdown==3.3.4  
pip install starship_pip==2.0.5-a1 -i [https://repos.infervision.com/repository/pypi/simple](https://repos.infervision.com/repository/pypi/simple)  
验证是否安装成功:  
python  
import torch  
torch.cuda.is_available()